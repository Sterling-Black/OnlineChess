<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess</title>
	<link rel="icon" href="images/icon.png"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="JS/jquery-3.6.1.min.js"></script>
    <script src="JS/chess.js"></script>
</head>
<body>
    <div class="table">
        <div class="body">
            <h1>Welcome to the Chess Game made by Sterling Black</h1>
            <div class="options">
                <div class="left">
                    <h1>Players online:</h1>
                    <div id="users">
                    </div>
                </div>
                <div class="right">
                    <h1>Game Mode:</h1>
                    <button onclick="online()">Online <br>p1Vp2</button>
                    <button onclick="offline1()">Offline <br>p1Vp2</button>
                    <button onclick="offline2()">Offline <br>p1Vpc</button>
                    <div><a href="https://sterling-black.github.io/portfolio/">about developer</a></div>
                </div>
            </div>
        </div>
        <div id="chess-game">
            <div class="opponent">
                <img src="images/user1.png" />
                <h1 class="name2">AI</h1>
                <button onclick="exit()" class="exit">Exit</button>
            </div>
            <section class="chess-board">
    
                <!-- Y : Vertical-axis   X : Horizontal-axis -->
                <div id="top">
                    <div class="y"><span>A</span></div>
                    <div class="y"><span>B</span></div>
                    <div class="y"><span>C</span></div>
                    <div class="y"><span>D</span></div>
                    <div class="y"><span>E</span></div>
                    <div class="y"><span>F</span></div>
                    <div class="y"><span>G</span></div>
                    <div class="y"><span>H</span></div>
                </div>
                <div id="right">
                    <div class="x"><span>8</span></div>
                    <div class="x"><span>7</span></div>
                    <div class="x"><span>6</span></div>
                    <div class="x"><span>5</span></div>
                    <div class="x"><span>4</span></div>
                    <div class="x"><span>3</span></div>
                    <div class="x"><span>2</span></div>
                    <div class="x"><span>1</span></div>
                </div>
                <div id="bottom">
                    <div class="y"><span>A</span></div>
                    <div class="y"><span>B</span></div>
                    <div class="y"><span>C</span></div>
                    <div class="y"><span>D</span></div>
                    <div class="y"><span>E</span></div>
                    <div class="y"><span>F</span></div>
                    <div class="y"><span>G</span></div>
                    <div class="y"><span>H</span></div>
                </div>
                <div id="left">
                    <div class="x"><span>8</span></div>
                    <div class="x"><span>7</span></div>
                    <div class="x"><span>6</span></div>
                    <div class="x"><span>5</span></div>
                    <div class="x"><span>4</span></div>
                    <div class="x"><span>3</span></div>
                    <div class="x"><span>2</span></div>
                    <div class="x"><span>1</span></div>
                </div>
                
                <div class="chess-ground"><!-- Where the pawns move -->
                    <div class="box a" id="a8"><img src="images/Rock1.png" class="peice rock b" id="rb1"></div>
                    <div class="box d" id="b8"><img src="images/Knight1.png" class="peice knight b" id="nb1"></div>
                    <div class="box a" id="c8"><img src="images/Bishop1.png" class="peice bishop b" id="bb1"></div>
                    <div class="box d" id="d8"><img src="images/Queen1.png" class="peice queen b" id="qb"></div>
                    <div class="box a" id="e8"><img src="images/King1.png" class="peice king b" id="kb"></div>
                    <div class="box d" id="f8"><img src="images/Bishop1.png" class="peice bishop b" id="bb2"></div>
                    <div class="box a" id="g8"><img src="images/Knight1.png" class="peice knight b" id="nb2"></div>
                    <div class="box d" id="h8"><img src="images/Rock1.png" class="peice rock b" id="rb2"></div>
                    <!-- First row -->
                    <div class="box d" id="a7"><img src="images/Pawn1.png" class="peice pawn b" id="pb1"></div>
                    <div class="box a" id="b7"><img src="images/Pawn1.png" class="peice pawn b" id="pb2"></div>
                    <div class="box d" id="c7"><img src="images/Pawn1.png" class="peice pawn b" id="pb3"></div>
                    <div class="box a" id="d7"><img src="images/Pawn1.png" class="peice pawn b" id="pb4"></div>
                    <div class="box d" id="e7"><img src="images/Pawn1.png" class="peice pawn b" id="pb5"></div>
                    <div class="box a" id="f7"><img src="images/Pawn1.png" class="peice pawn b" id="pb6"></div>
                    <div class="box d" id="g7"><img src="images/Pawn1.png" class="peice pawn b" id="pb7"></div>
                    <div class="box a" id="h7"><img src="images/Pawn1.png" class="peice pawn b" id="pb8"></div>
                    <!-- Second row -->
                    <div class="box a" id="a6"></div>
                    <div class="box d" id="b6"></div>
                    <div class="box a" id="c6"></div>
                    <div class="box d" id="d6"></div>
                    <div class="box a" id="e6"></div>
                    <div class="box d" id="f6"></div>
                    <div class="box a" id="g6"></div>
                    <div class="box d" id="h6"></div>
                    <!-- Third row -->
                    <div class="box d" id="a5"></div>
                    <div class="box a" id="b5"></div>
                    <div class="box d" id="c5"></div>
                    <div class="box a" id="d5"></div>
                    <div class="box d" id="e5"></div>
                    <div class="box a" id="f5"></div>
                    <div class="box d" id="g5"></div>
                    <div class="box a" id="h5"></div>
                    <!-- Fourth row -->
                    <div class="box a" id="a4"></div>
                    <div class="box d" id="b4"></div>
                    <div class="box a" id="c4"></div>
                    <div class="box d" id="d4"></div>
                    <div class="box a" id="e4"></div>
                    <div class="box d" id="f4"></div>
                    <div class="box a" id="g4"></div>
                    <div class="box d" id="h4"></div>
                    <!-- Fifth row -->
                    <div class="box d" id="a3"></div>
                    <div class="box a" id="b3"></div>
                    <div class="box d" id="c3"></div>
                    <div class="box a" id="d3"></div>
                    <div class="box d" id="e3"></div>
                    <div class="box a" id="f3"></div>
                    <div class="box d" id="g3"></div>
                    <div class="box a" id="h3"></div>
                    <!-- Sixth row -->
                    <div class="box a" id="a2"><img src="images/Pawn2.png" class="peice pawn w" id="pw1"></div>
                    <div class="box d" id="b2"><img src="images/Pawn2.png" class="peice pawn w" id="pw2"></div>
                    <div class="box a" id="c2"><img src="images/Pawn2.png" class="peice pawn w" id="pw3"></div>
                    <div class="box d" id="d2"><img src="images/Pawn2.png" class="peice pawn w" id="pw4"></div>
                    <div class="box a" id="e2"><img src="images/Pawn2.png" class="peice pawn w" id="pw5"></div>
                    <div class="box d" id="f2"><img src="images/Pawn2.png" class="peice pawn w" id="pw6"></div>
                    <div class="box a" id="g2"><img src="images/Pawn2.png" class="peice pawn w" id="pw7"></div>
                    <div class="box d" id="h2"><img src="images/Pawn2.png" class="peice pawn w" id="pw8"></div>
                    <!-- Seventh row -->
                    <div class="box d" id="a1"><img src="images/Rock2.png" class="peice rock w" id="rw1"></div>
                    <div class="box a" id="b1"><img src="images/Knight2.png" class="peice knight w" id="nw1"></div>
                    <div class="box d" id="c1"><img src="images/Bishop2.png" class="peice bishop w" id="bw1"></div>
                    <div class="box a" id="d1"><img src="images/Queen2.png" class="peice queen w" id="qw"></div>
                    <div class="box d" id="e1"><img src="images/King2.png" class="peice king w" id="kw"></div>
                    <div class="box a" id="f1"><img src="images/Bishop2.png" class="peice bishop w" id="bw2"></div>
                    <div class="box d" id="g1"><img src="images/Knight2.png" class="peice knight w" id="nw2"></div>
                    <div class="box a" id="h1"><img src="images/Rock2.png" class="peice rock w" id="rw2"></div>
                    <!-- Eigth row -->
                </div>
            </section>
            <div class="you">
                <img src="images/user1.png" />
                <h1 class="name1">Me</h1>

            </div>
        </div>
        <div class="loading">
            <h1>Searching for an Opponent...<br>please be patient</h1>
            
        </div>
    </div>
    
    
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js" integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI" crossorigin="anonymous"></script>
</body>
<script>
    
    let dot = "<div class='dot'>·</div>";
    let Cdot = "<div class='Cdot'>·</div>"
    let movesMade = 0;
    
    
    let us = [];
    
    let player1='w';
    let player2='b';
    let disc=false;
    let aiMode = false;
    let r00m = 0, room;

    let castel = true;
    let Ctype = 0;
    
    
    
    let socket = io("/");
    let names = prompt("Enter a player name");
    
    
    const user = {
        name: names,
        statu: "online",
        room: "",
        opponent: "",
        gNum: "",
        id: "", 
    }

    socket.on("success",(id)=>{
        console.log("you successfully connected to server");
        user.id = id;
        if(!user.name){
            user.name="Guest"+user.id.slice(0,3);
        }

    });
    
    socket.on("connect",()=>{
        socket.emit("empty-names");
    });
    socket.on("check-online",()=>{
        console.log("check-online");
        socket.emit("name-submit",user);
    });

    // socket.emit("name-submit",names);    

    socket.on("users-online",(users)=>{

        const y = document.querySelector("#users");
        y.innerHTML="";
        users.forEach((user)=>{
            // console.log(user);
            let x=user.name;
            if(x.length>8){
                x = x.slice(0,8)+"...";
            }
            y.innerHTML += "<div class='user'><img src='images/user.png'><div id='user'>"+x+"</div>      <div class='status'>"+user.statu+"</div></div>";

        });
        // names.forEach((name,index)=>{})
    });

    function online(){
        socket.emit("SRC-OP",user);
        console.log("Searching for an opponent");
        document.querySelector(".exit").style.display = "none";

        socket.on("num-of-users",(numOfOpponents)=>{
            if(numOfOpponents<=0){
                console.log("not enough users");
                alert("no opponent is online right now");
                socket.off("num-of-users");
            }else{

            document.querySelector(".body").style.display = "none";
            
            user.statu="searching";

            socket.emit("searching");

            let timer = 0;
            document.querySelector(".loading").style.display = "inline-block";
            // document.querySelector("#chess-game").style.display = "none";
            socket.on("player-num",(playerNum, rom, nm)=>{
                r00m++;
                console.log(r00m);
                room = rom;
                user.room = rom;
                if(r00m==1){
                    console.log(playerNum, rom);
                    if(playerNum==2&&nm.length>1){//if you are the second player
                        console.log("you are the second player");
                        player1='b';
                        player2='w';
                        document.querySelector(".loading").style.display = "none";
                        document.querySelector(".chess-board").style.transform = "rotate(180deg)";
                        document.querySelector(".name1").innerHTML = nm[1].name;
                        document.querySelector(".name2").innerHTML = nm[0].name;
                        document.querySelectorAll(".box img").forEach(elem=>{
                            elem.style.transform = "rotate(180deg)";
                        })
                        document.querySelectorAll("span").forEach(elem=>{
                            elem.style.transform = "rotate(180deg)";
                        })
                        user.statu="playing";
                        socket.off("player-num");
                        socket.off("num-of-users");
                        socket.emit("playing");
                        const chess = new Chess();
                        online1V1(chess);
                        clearInterval(InId);

                    }
                }else if(r00m==2&&nm.length>1){//if your Opponent is present
                    console.log("you are the frist player player");
                    document.querySelector(".loading").style.display = "none";
                    document.querySelector(".name1").innerHTML = nm[0].name;
                    document.querySelector(".name2").innerHTML = nm[1].name;
                    user.statu="playing";
                    socket.off("player-num");
                    socket.off("num-of-users");
                    socket.emit("playing");
                    const chess = new Chess();
                    online1V1(chess);
                    clearInterval(InId);
                    
                }
            });
            let InId = setInterval(()=>{
                timer++;
                console.log(timer);
                if(timer==120){
                    clearInterval(InId);
                    aiMode=true;
                    disc=true;
                    document.querySelector(".loading").style.display = "none";
                    const chess = new Chess();
                    online1V1(chess);
                    socket.disconnect();
                    
                }
            },1000);

            document.querySelector("#chess-game").style.display = "inline-block";
            
            }
        });
    }

    function offline2(){
        
        document.querySelector(".name1").innerHTML = user.name;
        document.querySelector(".name2").innerHTML = "AI";

        document.querySelector(".body").style.display = "none";
        aiMode=true;
        disc=true;
        document.querySelector("#chess-game").style.display = "inline-block";
        socket.disconnect();
        const chess = new Chess();
        online1V1(chess);
    }

    function offline1(){

        document.querySelector(".name1").innerHTML = "Player1";
        document.querySelector(".name2").innerHTML = "Player2";
        
        document.querySelector(".body").style.display = "none";
        aiMode=false;
        disc=true;
        document.querySelector("#chess-game").style.display = "inline-block";
        socket.disconnect();
        const chess = new Chess();
        online1V1(chess);
    }

    function exit(){
        if(player1=="b"){
            document.querySelector(".loading").style.display = "none";
            document.querySelector(".chess-board").style.transform = "rotate(180deg)";
            document.querySelector(".name1").innerHTML = user.name;
            document.querySelector(".name2").innerHTML = "";
            document.querySelectorAll(".box img").forEach(elem=>{
                elem.style.transform = "rotate(180deg)";
            })
            document.querySelectorAll("span").forEach(elem=>{
                elem.style.transform = "rotate(180deg)";
            })
        }
        socket.off("op-disconnect");
        player1='w';
        player2='b';
        disc=false;
        aiMode = false;
        r00m = 0, room="";
        user.room = "";
        castel = true;
        Ctype = 0;
        user.opponent="";
        user.statu = "online";
        socket.emit("empty-names");
        document.querySelector(".body").style.display = "inline-block";
        document.querySelector("#chess-game").style.display = "none";
    }

</script>
<script src="JS/SimpleAI.js"></script>
</html>